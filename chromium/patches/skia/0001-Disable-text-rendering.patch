From b5ce1b16eea8a09d65f2d6e7652ff42a1f5684a7 Mon Sep 17 00:00:00 2001
From: Fathy Boundjadj <hey@fathy.fr>
Date: Sun, 12 Feb 2023 01:07:07 +0100
Subject: [PATCH 1/2] Disable text rendering

---
 src/core/SkBitmapDevice.cpp | 14 ++++++++++++--
 src/core/SkBitmapDevice.h   |  2 ++
 2 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/src/core/SkBitmapDevice.cpp b/src/core/SkBitmapDevice.cpp
index b497d690f7..90da2d859e 100644
--- a/src/core/SkBitmapDevice.cpp
+++ b/src/core/SkBitmapDevice.cpp
@@ -518,12 +518,22 @@ void SkBitmapDevice::drawImageRect(const SkImage* image, const SkRect* src, cons
     this->drawRect(*dstPtr, paintWithShader);
 }
 
+namespace {
+    bool disable_text_rendering = false;
+}
+
+void SkBitmapDevice::DisableTextRendering() {
+    disable_text_rendering = true;
+}
+
 void SkBitmapDevice::onDrawGlyphRunList(SkCanvas* canvas,
                                         const sktext::GlyphRunList& glyphRunList,
                                         const SkPaint& initialPaint,
                                         const SkPaint& drawingPaint) {
-    SkASSERT(!glyphRunList.hasRSXForm());
-    LOOP_TILER( drawGlyphRunList(canvas, &fGlyphPainter, glyphRunList, drawingPaint), nullptr )
+    if (!disable_text_rendering) {
+        SkASSERT(!glyphRunList.hasRSXForm());
+        LOOP_TILER( drawGlyphRunList(canvas, &fGlyphPainter, glyphRunList, drawingPaint), nullptr )
+    }
 }
 
 void SkBitmapDevice::drawVertices(const SkVertices* vertices,
diff --git a/src/core/SkBitmapDevice.h b/src/core/SkBitmapDevice.h
index 946aac57cb..2d35be2198 100644
--- a/src/core/SkBitmapDevice.h
+++ b/src/core/SkBitmapDevice.h
@@ -50,6 +50,8 @@ public:
      */
     static SkBitmapDevice* Create(const SkImageInfo& info);
 
+    static void DisableTextRendering();
+
     /**
      *  Construct a new device with the specified bitmap as its backend. It is
      *  valid for the bitmap to have no pixels associated with it. In that case,
-- 
2.38.1


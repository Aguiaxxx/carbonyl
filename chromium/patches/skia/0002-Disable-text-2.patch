From cb3cd0b60600132b4ba8baa8e46185ad8bed3595 Mon Sep 17 00:00:00 2001
From: Fathy Boundjadj <hey@fathy.fr>
Date: Mon, 13 Feb 2023 17:14:27 +0100
Subject: [PATCH 2/3] Disable text 2

---
 src/core/SkBitmapDevice.cpp | 12 +++---------
 src/core/SkBitmapDevice.h   |  2 --
 2 files changed, 3 insertions(+), 11 deletions(-)

diff --git a/src/core/SkBitmapDevice.cpp b/src/core/SkBitmapDevice.cpp
index 90da2d859e..9631f47967 100644
--- a/src/core/SkBitmapDevice.cpp
+++ b/src/core/SkBitmapDevice.cpp
@@ -28,6 +28,8 @@
 #include "src/image/SkImage_Base.h"
 #include "src/text/GlyphRun.h"
 
+#include "carbonyl/src/browser/bridge.h"
+
 struct Bounder {
     SkRect  fBounds;
     bool    fHasBounds;
@@ -518,19 +520,11 @@ void SkBitmapDevice::drawImageRect(const SkImage* image, const SkRect* src, cons
     this->drawRect(*dstPtr, paintWithShader);
 }
 
-namespace {
-    bool disable_text_rendering = false;
-}
-
-void SkBitmapDevice::DisableTextRendering() {
-    disable_text_rendering = true;
-}
-
 void SkBitmapDevice::onDrawGlyphRunList(SkCanvas* canvas,
                                         const sktext::GlyphRunList& glyphRunList,
                                         const SkPaint& initialPaint,
                                         const SkPaint& drawingPaint) {
-    if (!disable_text_rendering) {
+    if (carbonyl::Bridge::BitmapMode()) {
         SkASSERT(!glyphRunList.hasRSXForm());
         LOOP_TILER( drawGlyphRunList(canvas, &fGlyphPainter, glyphRunList, drawingPaint), nullptr )
     }
diff --git a/src/core/SkBitmapDevice.h b/src/core/SkBitmapDevice.h
index 2d35be2198..946aac57cb 100644
--- a/src/core/SkBitmapDevice.h
+++ b/src/core/SkBitmapDevice.h
@@ -50,8 +50,6 @@ public:
      */
     static SkBitmapDevice* Create(const SkImageInfo& info);
 
-    static void DisableTextRendering();
-
     /**
      *  Construct a new device with the specified bitmap as its backend. It is
      *  valid for the bitmap to have no pixels associated with it. In that case,
